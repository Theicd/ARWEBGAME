<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <title>Iron Man AR Mk.V</title>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
    <!-- WebXR Hit Test Component -->
    <script src="https://unpkg.com/aframe-hit-test-controls@2.0.0/dist/aframe-hit-test-controls.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
    <link rel="stylesheet" href="style_v9.css">
</head>
<body>
    <!-- Install Modal -->
    <div id="install-modal" style="display:none;">
        <div class="modal-content">
            <div style="color:#00ffff; font-weight:bold; margin-bottom:10px;">INSTALL TACTICAL OS?</div>
            <button id="modal-install" class="modal-btn">CONFIRM</button>
            <button id="modal-close" class="modal-btn" style="border-color:#ff0000; color:#ff0000;">ABORT</button>
        </div>
    </div>

    <!-- HUD -->
    <div id="hud">
        <!-- TOP HUD BAR -->
        <div class="top-hud">
            <div class="compass-row">
                <div class="sensor-mini">ALT <span class="val" id="val-alt">--</span>m</div>
                <div class="heading-box" id="heading-num">000°</div>
                <div class="sensor-mini">SPD <span class="val" id="val-spd">0</span></div>
            </div>
        </div>

        <!-- CENTER: RETICLE + RANGEFINDER -->
        <div class="center-hud">
            <div class="reticle-box" id="reticle-box">
                <div class="ring-outer"></div>
                <div class="ring-middle"></div>
                <div class="ring-inner"></div>
                <div class="reticle-cross"></div>
            </div>
            <div class="rangefinder">
                <div class="range-label">DISTANCE</div>
                <div class="range-value" id="range-value">--.-</div>
                <div class="range-label">METERS</div>
                <div class="target-name" id="target-name">SCANNING...</div>
            </div>
        </div>

        <!-- AI OBJECT DETECTION BOX - LEFT SIDE -->
        <div class="ai-detection-box" id="ai-detection-box">
            <div class="ai-header">
                <span class="ai-icon">◎</span>
                <span>AI SCAN</span>
            </div>
            <div class="ai-object-list" id="ai-object-list">
                <div class="ai-item scanning">INITIALIZING...</div>
            </div>
        </div>

        <!-- BOTTOM HUD BAR -->
        <div class="bottom-hud">
            <!-- Left Panel: System -->
            <div class="hud-panel">
                <div class="hud-row">
                    <div class="data-block">
                        <span class="lbl">PWR</span>
                        <span class="val" id="val-pwr">100%</span>
                    </div>
                    <div class="data-block">
                        <span class="lbl">G</span>
                        <span class="val" id="val-g">1.0</span>
                    </div>
                </div>
                <div class="motion-indicator">
                    <div class="motion-dot" id="motion-dot"></div>
                    <span id="motion-status">IDLE</span>
                </div>
            </div>

            <!-- Center Panel: Voice + Radiation -->
            <div class="hud-panel" style="align-items: center;">
                <div class="voice-viz" id="voice-viz">
                    <div class="v-bar"></div><div class="v-bar"></div><div class="v-bar"></div><div class="v-bar"></div>
                    <div class="v-bar"></div><div class="v-bar"></div><div class="v-bar"></div><div class="v-bar"></div>
                    <div class="v-bar"></div><div class="v-bar"></div><div class="v-bar"></div><div class="v-bar"></div>
                </div>
                <div class="radiation-meter">
                    <span class="lbl">RADIATION</span>
                    <div class="rad-bar">
                        <div class="rad-fill" id="rad-fill"></div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Environment -->
            <div class="hud-panel" style="align-items: flex-end;">
                <div class="hud-row">
                    <div class="data-block">
                        <span class="lbl">LUX</span>
                        <span class="val" id="val-lux">--</span>
                    </div>
                    <div class="data-block">
                        <span class="lbl">MAG</span>
                        <span class="val" id="val-mag">--</span>
                    </div>
                </div>
                <button id="hud-install" style="pointer-events: auto;">INSTALL</button>
            </div>
        </div>
    </div>
    
    <!-- AR Scene -->
    <a-scene 
        renderer="alpha: true; antialias: true; colorManagement: true;"
        webxr="optionalFeatures: hit-test, dom-overlay; overlayElement: #hud;" 
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: false;" 
        vr-mode-ui="enabled: false">
        
        <a-entity id="reticle-target" hit-test-controls="mode: origin" visible="false">
            <a-ring rotation="-90 0 0" color="#00ffff" radius-inner="0.1" radius-outer="0.15"></a-ring>
        </a-entity>

        <a-entity id="target-dummy" visible="false" position="0 0 -3">
            <a-cylinder color="#333" height="0.1" radius="0.3"></a-cylinder>
            <a-cylinder color="#aaa" height="1.5" radius="0.05" position="0 0.75 0"></a-cylinder>
            <a-box color="#ff0000" depth="0.1" height="0.5" width="0.5" position="0 1.5 0"></a-box>
        </a-entity>

        <a-entity camera></a-entity>
    </a-scene>
    <script src="game_logic_v10.js"></script>
</body>
</html>
