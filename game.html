<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#00d4ff">
    <meta name="description" content="Iron Man AR Combat Mode - Tactical HUD">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="IronAR">
    <link rel="apple-touch-icon" href="icons/icon.svg">
    
    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="icons/icon.svg">
    <link rel="manifest" href="manifest.json">
    
    <title>Iron Man AR Â· Combat Mode</title>
    <script>
        // SW registration without notifications in game mode
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(() => {});
        }
    </script>
    <!-- A-Frame scripts loaded dynamically only when AR mode is needed -->
    
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
    <script src="logger.js"></script>
    <script src="calibration.js"></script>
    <link rel="stylesheet" href="style_v9.css">
    <style>
        html, body {
            background: #000 !important;
        }
        
        /* Camera video - always visible */
        #camera-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
        }
        
        /* A-Scene - completely hidden in 2D mode */
        a-scene.no-ar {
            display: none !important;
            visibility: hidden !important;
            pointer-events: none !important;
        }
        
        /* A-Scene in AR mode */
        a-scene:not(.no-ar) {
            position: fixed !important;
            top: 0;
            left: 0;
            z-index: 2;
        }
        
        /* HUD always on top */
        #hud {
            z-index: 100 !important;
        }
        
        /* AR button styling */
        .ar-btn {
            position: fixed;
            bottom: max(100px, calc(env(safe-area-inset-bottom) + 80px));
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #00aaff, #0066cc);
            color: white;
            border: 2px solid #00ffff;
            padding: 12px 30px;
            font-size: 14px;
            font-weight: bold;
            font-family: inherit;
            letter-spacing: 2px;
            cursor: pointer;
            z-index: 100000;
            box-shadow: 0 0 20px rgba(0,255,255,0.5);
            border-radius: 25px;
            display: none; /* Hidden by default, shown if AR supported */
        }
        
        .ar-btn.available {
            display: block;
        }
        
        .ar-btn.in-ar {
            background: linear-gradient(135deg, #ff6600, #cc3300);
            border-color: #ff6600;
        }
        
        /* Mode indicator */
        .mode-indicator {
            position: fixed;
            top: max(50px, calc(env(safe-area-inset-top) + 40px));
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: #00ffff;
            padding: 5px 15px;
            font-size: 10px;
            letter-spacing: 2px;
            border: 1px solid #00ffff;
            border-radius: 3px;
            z-index: 100001;
        }
        
        .mode-indicator.ar-mode {
            color: #00ff00;
            border-color: #00ff00;
        }
    </style>
</head>
<body>
    <!-- Camera Video (always visible) -->
    <video id="camera-video" autoplay playsinline muted></video>
    
    <!-- Mode Indicator -->
    <div class="mode-indicator" id="mode-indicator">2D MODE</div>

    <!-- HUD -->
    <div id="hud">
        <!-- TOP HUD BAR -->
        <div class="top-hud">
            <div class="compass-row">
                <div class="sensor-mini">ALT <span class="val" id="val-alt">--</span>m</div>
                <div class="heading-box" id="heading-num">000Â°</div>
                <div class="sensor-mini">SPD <span class="val" id="val-spd">0</span></div>
            </div>
        </div>

        <!-- CENTER: RETICLE + RANGEFINDER -->
        <div class="center-hud">
            <div class="reticle-box" id="reticle-box">
                <div class="ring-outer"></div>
                <div class="ring-middle"></div>
                <div class="ring-inner"></div>
                <div class="reticle-cross"></div>
            </div>
            <div class="rangefinder">
                <div class="range-label">DISTANCE</div>
                <div class="range-value" id="range-value">--.-</div>
                <div class="range-label">METERS</div>
                <div class="target-name" id="target-name">SCANNING...</div>
            </div>
        </div>

        <!-- AI OBJECT DETECTION BOX - LEFT SIDE -->
        <div class="ai-detection-box" id="ai-detection-box">
            <div class="ai-header">
                <span class="ai-icon">â—Ž</span>
                <span>AI SCAN</span>
            </div>
            <div class="ai-object-list" id="ai-object-list">
                <div class="ai-item scanning">INITIALIZING...</div>
            </div>
        </div>

        <!-- BOTTOM HUD BAR -->
        <div class="bottom-hud">
            <!-- Left Panel: System -->
            <div class="hud-panel">
                <div class="hud-row">
                    <div class="data-block">
                        <span class="lbl">PWR</span>
                        <span class="val" id="val-pwr">100%</span>
                    </div>
                    <div class="data-block">
                        <span class="lbl">G</span>
                        <span class="val" id="val-g">1.0</span>
                    </div>
                </div>
                <div class="motion-indicator">
                    <div class="motion-dot" id="motion-dot"></div>
                    <span id="motion-status">IDLE</span>
                </div>
            </div>

            <!-- Center Panel: Voice + Radiation -->
            <div class="hud-panel" style="align-items: center;">
                <div class="voice-viz" id="voice-viz">
                    <div class="v-bar"></div><div class="v-bar"></div><div class="v-bar"></div><div class="v-bar"></div>
                    <div class="v-bar"></div><div class="v-bar"></div><div class="v-bar"></div><div class="v-bar"></div>
                    <div class="v-bar"></div><div class="v-bar"></div><div class="v-bar"></div><div class="v-bar"></div>
                </div>
                <div class="radiation-meter">
                    <span class="lbl">RADIATION</span>
                    <div class="rad-bar">
                        <div class="rad-fill" id="rad-fill"></div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Environment -->
            <div class="hud-panel" style="align-items: flex-end;">
                <div class="hud-row">
                    <div class="data-block">
                        <span class="lbl">LUX</span>
                        <span class="val" id="val-lux">--</span>
                    </div>
                    <div class="data-block">
                        <span class="lbl">MAG</span>
                        <span class="val" id="val-mag">--</span>
                    </div>
                </div>
                <!-- No install button in game mode -->
            </div>
        </div>
    </div>
    
    <!-- AR Scene container - A-Frame loads dynamically only when AR mode is activated -->
    <div id="ar-container"></div>
    
    <!-- Mode Selection Buttons -->
    <div id="mode-buttons" style="
        position: fixed;
        bottom: max(20px, env(safe-area-inset-bottom));
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
        z-index: 100000;
    ">
        <button id="btn-2d" class="mode-btn active" onclick="setMode('2D')">
            ðŸ“· 2D MODE
        </button>
        <button id="btn-ar" class="mode-btn" onclick="setMode('AR')" style="display:none;">
            ðŸ”® AR MODE
        </button>
    </div>
    
    <style>
        .mode-btn {
            padding: 12px 20px;
            border: 2px solid #00ffff;
            background: rgba(0,20,40,0.9);
            color: #00ffff;
            font-size: 12px;
            font-weight: bold;
            letter-spacing: 1px;
            cursor: pointer;
            border-radius: 25px;
            transition: all 0.3s;
        }
        .mode-btn.active {
            background: #00ffff;
            color: #000;
        }
        .mode-btn:not(.active):hover {
            background: rgba(0,255,255,0.2);
        }
    </style>
    <script src="game_logic_v10.js"></script>
</body>
</html>
